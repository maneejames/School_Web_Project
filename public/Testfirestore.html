<!DOCTYPE html>
<html>
<head>
    <title>User Registration</title>
</head>
<body>
    <h1>User Registration</h1>
    <form id="registration-form">
        <label for="fullName">Full Name:</label>
        <input type="text" id="fullName" name="fullName" required><br><br>

        <label for="userName">Username:</label>
        <input type="text" id="userName" name="userName" required><br><br>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br><br>

        <label for="dateOfBirth">Date of Birth:</label>
        <input type="date" id="dateOfBirth" name="dateOfBirth" required><br><br>

        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br><br>

        <button type="button" onclick="handlesubmit()">Register</button>
    </form>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
        import { getAuth, GoogleAuthProvider, signInWithRedirect, getRedirectResult } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
        import { collection, getFirestore, doc,  setDoc, addDoc} from "firebase/firestore";
        // Your web app's Firebase configuration
        const firebaseConfig = {
        apiKey: "AIzaSyAIwzxvlLd9UTZXC_qc3fqZ9Qarifhjzcs",
        authDomain: "school-openhouse.firebaseapp.com",
        projectId: "school-openhouse",
        storageBucket: "school-openhouse.appspot.com",
        messagingSenderId: "321971868041",
        appId: "1:321971868041:web:66ddb25a464ab8ea11d158"
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider(app);
        
        // Initialize Cloud Firestore and get a reference to the service
        const db = getFirestore(app);

        googleLogin.addEventListener('click',(e) => {
            signInWithRedirect(auth, provider);

            getRedirectResult(auth)
            .then((result) => {
                // This gives you a Google Access Token. You can use it to access Google APIs.
                const credential = GoogleAuthProvider.credentialFromResult(result);
                const token = credential.accessToken;

                // The signed-in user info.
                const user = result.user;
                // IdP data available using getAdditionalUserInfo(result)
                // ...
            }).catch((error) => {
                // Handle Errors here.
                const errorCode = error.code;
                const errorMessage = error.message;
                // The email of the user's account used.
                const email = error.customData.email;
                // The AuthCredential type that was used.
                const credential = GoogleAuthProvider.credentialFromError(error);
                // ...
            });
        })

        const [fullName, setFullName] = useState<string>("");
        const [email, setEmail] = useState<string>("");
        const [password, setPassword] = useState<string>("");
        const [dateOfBirth, setDateOfBirth] = useState<string>("")
        const [userName, setUsername] = useState<string>("");


        const handlesubmit = () => {
                createUserWithEmailAndPassword(auth, email, password)
                    .then(async (response) => {
                        const userid = response.user.uid;
                        setTimeout(() => {
                            navigate(`public\new-about.html`);
                        }, 3000);
                        try {
                            await setDoc(doc(db, "users", userid), {
                                fullName: fullName,
                                username: userName,
                                email: email,
                                dateOfBirth: dateOfBirth,
                            });
                        } catch (e) {
                            console.error("Error adding document: ", e);
                        }
                    })
                    .catch((error) => {
                        console.log(error)
                        }
                    );
        };
    </script>
</body>
</html>