<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EP-MWS Openhouse 2023</title>
    <link rel="stylesheet" href="Style/form.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
            import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, browserLocalPersistence, setPersistence} from "https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js";
            import { getFirestore, collection, addDoc, updateDoc, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

            const firebaseConfig = {
                    apiKey: "AIzaSyAIwzxvlLd9UTZXC_qc3fqZ9Qarifhjzcs",
                    authDomain: "school-openhouse.firebaseapp.com",
                    projectId: "school-openhouse",
                    storageBucket: "school-openhouse.appspot.com",
                    messagingSenderId: "321971868041",
                    appId: "1:321971868041:web:66ddb25a464ab8ea11d158"
            };

            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const firestore = getFirestore(app);

            const signupForm = document.getElementById('signup-form');

            signupForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value; // Add classroom input field
                const prefix = document.getElementById('prefix').value;
                const firstname = document.getElementById('first-name').value;
                const lastname = document.getElementById('last-name').value;
                const student = document.getElementById('student').value;
                const teacher = document.getElementById('teacher').value;
                const parent = document.getElementById('parent').value;
                const generalpublic = document.getElementById('general-public').value;
                const education = document.getElementById('education').value;
                const school = document.getElementById('school').value;
                const province = document.getElementById('province').value;


                const stamps = [
                    { name: 'Stamp 1', value: false },
                    { name: 'Stamp 2', value: false },
                    { name: 'Stamp 3', value: false }
                ];

                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;

                    // Store user data in Firestore
                    const userDocRef = doc(firestore, 'users', user.uid);
                    await setDoc(userDocRef, {
                        email: user.email,
                        prefix: prefix, 
                        firstname: firstname, 
                        lastname: lastname, 
                        student: student, 
                        teacher: teacher, 
                        parent: parent,
                        generalpublic: generalpublic,
                        education: education,
                        school: school,
                        province: province,
                        stamps: stamps,
                    });

                    alert('User registration successful');

                    // Redirect to another page after successful sign-up
                    window.location.href = 'login-already.html';
                } catch (error) {
                    alert('User registration failed. ' + error.message);
                }
            });
        </script>
</head>

<body>
    <!--================================================== HEADER ==================================================-->
    <header>
        <a href="new-about.html"><i class="fa-solid fa-arrow-left"></i> Back</a>
    </header>
    <!--================================================== HEADER ==================================================-->

    <!--================================================== FORM ==================================================-->
    <section class="form" id="signup-form">
        <div class="container">
            <div class="topic">
                <h1>Sign up</h1>
            </div>
            <div class="content">
                <form action="">
                    <div class="name">
                        <div class="prefix">
                            <label for="prefix">Prefix :</label>
                            <select name="prefix" id="prefix" required>
                                <option disabled selected value="-"></option>
                                <option value="master">Master</option>
                                <option value="miss">Miss</option>
                                <option value="Mr.">Mr.</option>
                                <option value="Mrs.">Mrs.</option>
                            </select>
                        </div>
                        <div class="fname">
                            <label for="first-name">First name :</label>
                            <input type="text" id="first-name" required>
                        </div>
                        <div class="lname">
                            <label for="last-name">Last name :</label>
                            <input type="text" id="last-name" required>
                        </div>
                        <div>
                            <label for="last-name">Email :</label>
                            <input type="email" id="signup-email" placeholder="Email" required>
                        </div>
                        <div>
                            <label for="last-name">Password :</label>
                            <input type="password" id="signup-password" placeholder="Password" required>
                        </div>
                    </div>
                    <div class="user-type">
                        <label for="user-type">User type :</label>
                        <div class="choice">
                            <input type="radio" id="student" name="choice">
                            <label for="student">Student</label>
                            <input type="radio" id="teacher" name="choice">
                            <label for="teacher">Teacher</label>
                            <input type="radio" id="parent" name="choice">
                            <label for="parent">Parent</label>
                            <input type="radio" id="general-public" name="choice">
                            <label for="general-public">General Public</label>
                        </div>
                        <script>
                            const rdStudent = document.getElementById("student");
                            const rdTeacher = document.getElementById("teacher");
                            const rdParent = document.getElementById("parent");
                            const rdGeneralPublic = document.getElementById("general-public");
                            
                            rdStudent.onclick = function () {
                                document.querySelector(".student").style.display="block";
                                document.querySelector(".teacher").style.display="none";
                            }

                            rdTeacher.onclick = function () {
                                document.querySelector(".student").style.display="none";
                                document.querySelector(".teacher").style.display="block";
                            }

                            rdParent.onclick = function () {
                                document.querySelector(".student").style.display="none";
                                document.querySelector(".teacher").style.display="none";
                            }

                            rdGeneralPublic.onclick = function () {
                                document.querySelector(".student").style.display="none";
                                document.querySelector(".teacher").style.display="none";
                            }
                        </script>
                    </div>
                    <div class="student">
                        <div class="education">
                            <label for="education">Education level :</label>
                            <select name="education" id="education" required>
                                <option disabled selected value="-"></option>
                                <option value="grade-1-3">Grade 1-3</option>
                                <option value="grade-4-6">Grade 4-6</option>
                                <option value="grade-7-9">Grade 7-9</option>
                                <option value="grade-10-12">Grade 10-12</option>
                            </select>
                        </div>
                        <div class="school">
                            <label for="school">School name :</label>
                            <input type="text" id="school">
                        </div>
                        <div class="province">
                            <label for="province">School provincial :</label>
                            <input type="text" id="province">
                        </div>
                    </div>
                    <div class="teacher">
                        <div class="school">
                            <label for="school">School name :</label>
                            <input type="text" id="school">
                        </div>
                        <div class="province">
                            <label for="province">School provincial :</label>
                            <input type="text" id="province">
                        </div>
                    </div>
                    <button type="submit">Sign up</button>
                </form>
            </div>
        </div>
    </section>
    <!--================================================== FORM ==================================================-->
</body>

</html>